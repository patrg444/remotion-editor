const fs = require('fs');
const path = require('path');

const VIDEO_DIR = path.join(__dirname, '..', 'test-assets');
const VIDEO_PATH = path.join(VIDEO_DIR, 'test.mp4');

// Create test-assets directory if it doesn't exist
if (!fs.existsSync(VIDEO_DIR)) {
    fs.mkdirSync(VIDEO_DIR, { recursive: true });
}

// Create a minimal MP4 file with H.264 baseline profile
const videoData = Buffer.from([
    0x00, 0x00, 0x00, 0x20, 0x66, 0x74, 0x79, 0x70, 0x69, 0x73, 0x6F, 0x6D,
    0x00, 0x00, 0x02, 0x00, 0x69, 0x73, 0x6F, 0x6D, 0x69, 0x73, 0x6F, 0x32,
    0x6D, 0x70, 0x34, 0x31, 0x00, 0x00, 0x00, 0x08, 0x66, 0x72, 0x65, 0x65,
    0x00, 0x00, 0x02, 0x00, 0x6D, 0x64, 0x61, 0x74,
    // Add a minimal H.264 baseline profile frame
    0x00, 0x00, 0x00, 0x01, 0x67, 0x42, 0x00, 0x1E, 0x9A, 0x74, 0x05, 0x81,
    0xEC, 0x80, 0x00, 0x00, 0x00, 0x01, 0x68, 0xCE, 0x32, 0x28, 0x00, 0x00,
    0x00, 0x01, 0x65, 0x88, 0x80, 0x00, 0x00, 0x00, 0x01, 0x61, 0xE0, 0x00,
    0x00, 0x00, 0x01, 0x41, 0x9A, 0x20, 0x00, 0x00, 0x00, 0x01, 0x41, 0x9A
]);

fs.writeFileSync(VIDEO_PATH, videoData);
console.log(`Test video file created at: ${VIDEO_PATH}`);
